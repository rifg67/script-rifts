#!/bin/bash

# Warna
y='\033[1;93m'; r="\033[1;31m"; g="\e[92;1m"; NC='\e[0m'
bc="\e[5;36m"

# Konfigurasi GitHub dan Telegram
USER="PeyxDev"
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"
REPO_URL="https://$TOKEN@github.com/$USER/PeyxDev.git"
CHATID="7661292905"
KEY="7916829256:AAHB-_Jv24fTQfR98HA6eNogR8zzYzChw6g"
URL="https://api.telegram.org/bot$KEY/sendMessage"

# Fungsi garis
lane() { echo -e "${bc}â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”${NC}"; }

# Kirim Telegram
send_telegram() {
    local pesan="$1"
    curl -s --max-time 10 \
    -d "chat_id=$CHATID&disable_web_page_preview=1&parse_mode=html&text=$pesan" \
    $URL >/dev/null
}

# Cek & Install Dependensi
for pkg in git curl; do
  [[ ! -f /usr/bin/$pkg ]] && apt install $pkg -y &>/dev/null
done

# Ambil daftar IP
clear
echo -e "${y}=== DAFTAR IP VPS TERDAFTAR ===${NC}"
lane
echo -e "USERNAME         EXPIRED         IP VPS"
lane

rm -rf /root/PeyxDev
git clone -q $REPO_URL /root/PeyxDev
cd /root/PeyxDev || exit

if grep -q "^###" ipx; then
    MSG="ðŸ“‹ <b>DAFTAR IP VPS TERDAFTAR</b>%0A%0A<code>USERNAME      EXPIRED      IP</code>%0A"
    while read -r line; do
        name=$(echo "$line" | awk '{print $2}')
        exp=$(echo "$line" | awk '{print $3}')
        ip=$(echo "$line" | awk '{print $4}')
        
        if [[ $(date -d "$exp" +%s) -lt $(date +%s) ]]; then
            printf "%-15s ${r}%-15s${NC} %-15s\n" "$name" "$exp" "$ip"
        else
            printf "%-15s %-15s %-15s\n" "$name" "$exp" "$ip"
        fi
        
        MSG+="<code>$(printf "%-12s %-12s %-15s" "$name" "$exp" "$ip")</code>%0A"
    done < <(grep -E "^###" ipx)
    lane
    
    send_telegram "$MSG"
    echo -e "${g}âœ… Daftar IP juga telah dikirim ke Telegram.${NC}"
else
    echo -e "${r}Tidak ada data IP terdaftar!${NC}"
fi
